import app
from app import db
from app.models import Log,Code,Language,User,Game,Game_lib

# add language
# add user
# add game
# add room(log)
# add code
# test check code


# Language
lan1 = Language(language_name='c',filename_extension=".c")
lan2 = Language(language_name='python', filename_extension=".py")
db.session.add_all([lan1,lan2])
db.session.commit()


#user = User(username=form.username.data, email=form.email.data)
#user.set_password(form.password.data)

#user = User(username='11', email="bigbigtreeful@gmail.com")
#user.set_password('11')
#db.session.add(user)
#db.session.commit()

#Catagory
cat = Category(name="brainstorming")
cat2 = Category(name="acting")
db.session.add_all([cat,cat2])
db.session.commit()

#game = Game(user_id=form.user_id.data,gamename=form.gamename.data,descript=form.descript.data,\ #player_num=form.player_num.data,category_id=form.category_id.data,game_lib_id=form.game_lib_id.data)

game_lib = Game_lib(language_id=1,player_num=2,game_info=game[0])
game_lib2 = Game_lib(language_id=2,player_num=2,game_info=game[0])
game = Game(user_id=1,gamename='t1',descript='t1',player_num=2,category_id=1)
db.session.add_all([game,game_lib,game_lib2])
db.session.commit()


#log = Log(game_id=add_form.game.data,privacy=add_form.privacy.data,status=players)
log = Log(game_id=1,privacy=1,status=2)
db.session.add(log)
db.session.commit()

#code = Code(log_id=log_id, body=code_data, commit_msg=commit_msg,game_id=l.game_id,user_id=current_user.id)


db.session.add(code)
db.session.commit()


log_id=1
l=Log.query.filter_by(id=1).first()
current_user =User.query.filter_by(id=1).first()
message={'room': 1,'code': 1, 'language':2}
checked_code =Code.query.with_entities(Code.id, Code.commit_msg,Language.language_name).filter_by(game_id=l.game_id, user_id=current_user.id,compile_language_id=message['language']).join(Log,(Log.id==1)).join(Language,(Language.id==message['language'])).order_by(Code.id.desc()).first()
print(checked_code)


all_codes =Code.query.with_entities(Code.id, Code.commit_msg,Language.language_name).filter_by(game_id=1, user_id=2).join(Log,(Log.id==1)).join(Language,(Language.id==Code.compile_language_id)).order_by(Code.id.desc()).all()
print(all_codes)